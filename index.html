<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>POLITIE OPSPORING - Beveiligde Unit Login</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #001a33; color: white; text-align: center; padding: 20px; margin: 0; }
        .ui-box { background: rgba(0, 40, 80, 0.8); padding: 20px; border-radius: 10px; display: inline-block; border: 2px solid #005ce6; min-width: 350px; margin-bottom: 20px; box-shadow: 0 0 15px rgba(0, 92, 230, 0.5); vertical-align: top; }
        
        h1::before, h1::after { content: "ðŸŸ¦"; animation: flash 0.8s infinite; }
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .btn { background: #ffd700; color: #001a33; padding: 10px 15px; margin: 3px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 0.85em; transition: 0.2s; }
        .btn:hover { background: #fff; }
        .btn-time { background: #003366; color: white; border: 1px solid #005ce6; width: 60px; }
        .btn-active { background: #005ce6 !important; color: white; border: 1px solid #ffd700; }
        .btn-danger { background: #ff4747; color: white; margin-top: 10px; width: 85%; }
        
        .target-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; }
        .hidden { display: none !important; }
        #playground-img { max-width: 95vw; border: 5px solid #003366; margin-top: 20px; cursor: crosshair; }
        #timer { font-size: 3.5em; color: #3399ff; font-family: monospace; font-weight: bold; }
        
        #bericht-venster { background: rgba(0,0,0,0.8); padding: 15px; border-radius: 5px; color: #3399ff; font-size: 1.2em; margin-top: 10px; border: 2px solid #005ce6; min-height: 50px; transition: 0.3s; }
        .nieuw-bericht { animation: pulse-border 1.5s infinite; }
        @keyframes pulse-border { 0% { border-color: #005ce6; } 50% { border-color: #ffd700; } 100% { border-color: #005ce6; } }

        #winnaar-display { font-size: 2em; color: #ffd700; background: rgba(0, 92, 230, 0.3); border: 2px solid #ffd700; padding: 15px; margin: 10px 0; display: none; border-radius: 10px; }
        
        input { padding: 12px; width: 80%; font-size: 1.1em; border-radius: 5px; border: 2px solid #005ce6; background: #001a33; color: white; margin-bottom: 10px; text-align: center; }
        .label-text { font-size: 0.9em; color: #ffd700; font-weight: bold; display: block; margin-top: 10px; text-transform: uppercase; }

        .protocol-box { text-align: left; background: rgba(0,0,0,0.4); padding: 12px; border-radius: 5px; margin-top: 15px; border-left: 4px solid #ffd700; font-size: 0.85em; line-height: 1.4; }
    </style>
</head>
<body>

    <h1> POLITIE OPSPORING </h1>

    <div id="setup-section">
        <div class="ui-box">
            <h3>DIENST LOGIN</h3>
            <input type="text" id="user-name" placeholder="Uw voornaam...">
            <br><br>
            <button class="btn" onclick="probeerLogin('verbalisant')">UNIT 1: DOCENT (VERBALISANT)</button>
            <button class="btn" onclick="probeerLogin('collega')">UNIT 2: RECHERCHEUR (COLLEGA)</button>
            <p id="login-fout" style="color: #ff4747; font-weight: bold; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div id="winnaar-display"></div>
        
        <div id="verbalisant-ui" class="hidden">
            <div class="ui-box">
                <span class="label-text">1. INZETTID (SEC)</span>
                <button id="t10" class="btn btn-time" onclick="setTimer(10)">10</button>
                <button id="t15" class="btn btn-time btn-active" onclick="setTimer(15)">15</button>
                <button id="t20" class="btn btn-time" onclick="setTimer(20)">20</button>
                
                <span class="label-text">2. OBJECT VAN OPSPORING</span>
                <div class="target-grid" id="target-buttons"></div>
                
                <div class="protocol-box">
                    <strong style="color: #ffd700;">PROTOCOL SIGNALEMENT:</strong><br>
                    <span style="color: #00ccff;">â€¢ Onveranderlijk:</span> Geslacht, leeftijd, lengte, haarkleur, ogen, bijzonderheden gezicht.<br>
                    <span style="color: #00ccff;">â€¢ Veranderlijk:</span> Pet, bril, beugel, bovenkleding (type/kleur), schoeisel.
                </div>

                <span class="label-text">3. DOORGEVEN SIGNALEMENT</span>
                <input type="text" id="input-tekst" placeholder="Beschrijf volgens protocol...">
                <button class="btn" style="background: #005ce6; color: white; width: 85%; margin-top: 10px;" onclick="verstuurBericht()">ZEND MELDING</button>
                
                <p id="status-bericht" style="color: #ffd700; font-weight: bold;"></p>
                <hr style="border: 0.5px solid #005ce6; margin: 20px 0;">
                <button class="btn btn-danger" onclick="hardReset()">VOLLEDIGE SPEL-RESET</button>
                <button class="btn" style="background: #444; color: white;" onclick="logOut()">LOG OUT</button>
            </div>
        </div>

        <div id="collega-ui" class="hidden">
            <div class="ui-box">
                <div id="timer">--</div>
                <div id="bericht-venster">Wachten op bericht van meldkamer...</div>
            </div>
        </div>

        <div>
            <img src="speeltuin.jpg" id="playground-img" onclick="checkKlik(event)">
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBOo2LzR1IBnsiBR2SCwPJABtaRv0tpKQ4",
        authDomain: "speeltuin-recherche.firebaseapp.com",
        databaseURL: "https://speeltuin-recherche-default-rtdb.europe-west1.firebasedatabase.app/", 
        projectId: "speeltuin-recherche",
        appId: "1:499912834123:web:3c84cbf4d5eb13131961ce"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const gameRef = db.ref('playground_recherche');

    const targets = [
        { name: "Glijbaan", x: 670, y: 440 }, { name: "Wipkip", x: 180, y: 750 },
        { name: "Blauwe Pet", x: 170, y: 680 }, { name: "Klimrek", x: 700, y: 350 },
        { name: "Draaimolen L", x: 550, y: 750 }, { name: "Draaimolen R", x: 700, y: 750 },
        { name: "Wipwap L", x: 150, y: 530 }, { name: "Wipwap R", x: 300, y: 510 },
        { name: "Zandbak", x: 350, y: 680 }, { name: "Boom", x: 450, y: 250 }
    ];

    let mijnNaam = '';
    let huidigeRol = '';
    let actiefTargetIndex = -1;
    let timerRunning = false;
    let countdown;
    let gekozenTijd = 15;

    const btnContainer = document.getElementById('target-buttons');
    targets.forEach((t, index) => {
        const b = document.createElement('button');
        b.className = 'btn';
        b.innerText = t.name;
        b.onclick = () => kiesTarget(index, t.name);
        btnContainer.appendChild(b);
    });

    function probeerLogin(rol) {
        mijnNaam = document.getElementById('user-name').value;
        if(!mijnNaam) { alert("Vul eerst uw naam in."); return; }
        if(rol === 'verbalisant') {
            gameRef.child('active_verbalisant').get().then((snap) => {
                if(snap.exists() && snap.val() !== mijnNaam) {
                    document.getElementById('login-fout').innerText = "Er is al een Docent actief!";
                } else {
                    gameRef.update({ active_verbalisant: mijnNaam });
                    startApp('verbalisant');
                }
            });
        } else { startApp('collega'); }
    }

    function startApp(rol) {
        huidigeRol = rol;
        document.getElementById('setup-section').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        if(rol === 'verbalisant') document.getElementById('verbalisant-ui').classList.remove('hidden');
        else document.getElementById('collega-ui').classList.remove('hidden');
        luisterNaarUpdates();
    }

    function logOut() {
        if(confirm("Dienst beÃ«indigen?")) {
            if(huidigeRol === 'verbalisant') gameRef.child('active_verbalisant').remove();
            location.reload();
        }
    }

    function hardReset() {
        gameRef.update({ start: false, winnaar: null, tekst: "", targetId: -1, tijd: 15 });
        document.getElementById('input-tekst').value = "";
        document.getElementById('status-bericht').innerText = "SYSTEEM GERESET";
    }

    function setTimer(sec) {
        gekozenTijd = sec;
        document.querySelectorAll('.btn-time').forEach(b => b.classList.remove('btn-active'));
        document.getElementById('t' + sec).classList.add('btn-active');
    }

    function kiesTarget(index, naam) {
        actiefTargetIndex = index;
        document.getElementById('status-bericht').innerText = "DOELWIT: " + naam;
        gameRef.update({ targetId: index, start: false, winnaar: null });
    }

    function verstuurBericht() {
        const tekst = document.getElementById('input-tekst').value;
        if(actiefTargetIndex === -1) { alert("Selecteer eerst een object!"); return; }
        gameRef.update({ tekst: tekst, start: true, tijd: gekozenTijd, v_naam: mijnNaam, winnaar: null });
    }

    function luisterNaarUpdates() {
        gameRef.on('value', (snap) => {
            const data = snap.val();
            if(!data) return;

            const venster = document.getElementById('bericht-venster');
            if(data.tekst) {
                venster.innerHTML = `<strong>MELDING ${data.v_naam}:</strong><br>${data.tekst}`;
                if(data.start) venster.classList.add('nieuw-bericht');
            } else {
                venster.innerHTML = "Wachten op melding...";
                venster.classList.remove('nieuw-bericht');
            }

            const winDisplay = document.getElementById('winnaar-display');
            if(data.winnaar) {
                winDisplay.innerHTML = `ðŸ† DOELWIT GEVONDEN DOOR: ${data.winnaar}`;
                winDisplay.style.display = 'block';
                clearInterval(countdown);
                timerRunning = false;
                if(huidigeRol === 'verbalisant') setTimeout(() => { if(data.winnaar) hardReset(); }, 8000);
            } else {
                winDisplay.style.display = 'none';
            }

            actiefTargetIndex = data.targetId;
            if(data.start && !timerRunning && !data.winnaar) startTimer(data.tijd);
            if(!data.start) { clearInterval(countdown); timerRunning = false; resetTimerUI(data.tijd || 15); }
        });
    }

    function startTimer(duur) {
        timerRunning = true;
        let t = duur;
        countdown = setInterval(() => {
            t -= 0.1;
            const el = document.getElementById('timer');
            if(el) el.innerText = t.toFixed(1);
            if(t <= 0) {
                clearInterval(countdown);
                timerRunning = false;
                if(huidigeRol === 'collega') alert("DOELWIT ONTSNAPT! (Tijd om)");
            }
        }, 100);
    }

    function resetTimerUI(duur) {
        const el = document.getElementById('timer');
        if(el) el.innerText = parseFloat(duur).toFixed(1);
    }

    function checkKlik(event) {
        if(huidigeRol !== 'collega' || !timerRunning) return;
        const img = document.getElementById('playground-img');
        const rect = img.getBoundingClientRect();
        const scaleX = img.naturalWidth / rect.width;
        const scaleY = img.naturalHeight / rect.height;
        const kX = (event.clientX - rect.left) * scaleX;
        const kY = (event.clientY - rect.top) * scaleY;
        const doel = targets[actiefTargetIndex];
        if(Math.sqrt(Math.pow(kX - doel.x, 2) + Math.pow(kY - doel.y, 2)) < 110) {
            gameRef.update({ winnaar: mijnNaam, start: false });
        }
    }
</script>
</body>
</html>
